ICU Patient count,select count (distinct subject_id) from `physionet-data.mimic_icu.icustays`
ICU patient proportion,select count (distinct subject_id) from `physionet-data.mimic_core.admissions`
ICU admissions proportion,select count (distinct hadm_id) from `physionet-data.mimic_core.admissions`
Adult ICU admissions age proportion,"with hospital as (select al.hadm_id, al.subject_id from physionet-data.mimic_icu.icustays al), icu as (select ic.subject_id, ic.anchor_age from physionet-data.mimic_core.patients ic where anchor_age>18) SELECT (al.hadm_id, al.subject_id) from hospital al inner join icu ON icu.subject_id = al.subject_id"
ICU admissions age distribution,"with hospital as (select al.age, al.hadm_id, al.subject_id from `physionet-data.mimic_derived.age` alwhere age>18), icu as (select distinct  ic.hadm_id,from `physionet-data.mimic_icu.icustays` ic) SELECT  approx_quantiles(al.age, 5) from hospital al inner join icu ON icu.hadm_id = al.hadm_id"
ICU record proportion,
Mortality extraction point,
Mortality ICU,"SELECT distinct a.subject_id, a.deathtime, icu.subject_id, icu.intime, icu.outtime, icu.stay_id
FROM physionet-data.mimic_core.admissions AS a
inner JOIN physionet-data.mimic_icu.icustays AS icu
ON a.subject_id = icu.subject_id
SELECT icu.subject_id, icu.intime, icu.outtime, icu.stay_id
FROM physionet-data.mimic_icu.icustays AS icu"
Length of stay,see above
Quality of Life,-
Comorbidities,"SELECT hos.hadm_id, hos.icd_code, icu.hadm_id
FROM physionet-data.mimic_hosp.diagnoses_icd AS hos
inner JOIN physionet-data.mimic_icu.icustays AS icu
ON hos.hadm_id = icu.hadm_id"
Severity of Illness registration,
Admission reason elective / urgent / unknown,"SELECT adm.admission_type, adm.hadm_id, icu.hadm_id, icu.first_careunit
FROM physionet-data.mimic_core.admissions AS adm
inner JOIN physionet-data.mimic_icu.icustays AS icu
ON adm.hadm_id = icu.hadm_id"
Admission reason surgical / medical / other /unknown,see above
Vasopressor usage,"WAS SPLITTED INTO 3 SEPRATE QUERIES AND COMBINED IN R
SELECT distinct dob.stay_id, sum(dob.vaso_amount), dop.stay_id, sum(dop.vaso_amount), epi.stay_id, sum(epi.vaso_amount), phen.stay_id, sum(phen.vaso_amount), vaso.stay_id, sum(vaso.vaso_amount), nor.stay_id, sum(nor.vaso_amount)
FROM physionet-data.mimic_derived.dobutamine AS dob
left join physionet-data.mimic_derived.dopamine AS dop
on dob.stay_id = dop.stay_id
group by dob_stay_id
left join physionet-data.mimic_derived.epinephrine as epi
on dob.stay_id = epi.stay_id
left join physionet-data.mimic_derived.phenylephrine as phen
on dob.stay_id = phen.stay_id
left join physionet-data.mimic_derived.vasopressin as vaso
on dob.stay_id = vaso.stay_id 
left join `physionet-data.mimic_derived.norepinephrine` AS nor
on dob.stay_id = nor.stay_id"
CRRT usage,"SELECT distinct stay_id, dialysis_present, dialysis_active FROM `physionet-data.mimic_derived.rrt` 
where dialysis_active =1"
ECMO usage,"SELECT itemid, label FROM `physionet-data.mimic_icu.d_items` where label like 'ECMO' --> 224660
SELECT distinct hadm_id, stay_id FROM `physionet-data.mimic_icu.chartevents` 
where itemid=224660"
Mechanical ventilation usage,"SELECT distinct stay_id FROM `physionet-data.mimic_derived.ventilation` 
where ventilation_status = ""InvasiveVent"" OR ventilation_status = ""Trach"""
Frequency of respiratory rate records,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.resp_rateFROM  `physionet-data.mimic_derived.vitalsign` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.resp_rate IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((resp_rate))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
"O2 saturation, peripheral","WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.spo2FROM  `physionet-data.mimic_derived.vitalsign` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.spo2 IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((spo2))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Frequency of FiO2 records,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.fio2FROM  `physionet-data.mimic_derived.ventilator_setting` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.fio2 IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((fio2))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Frequency of ventilation mode: mechanical / spontaneous breathing modes,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.ventilator_modeFROM  `physionet-data.mimic_derived.ventilator_setting` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.ventilator_mode IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((ventilator_mode))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
PEEP,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.peepFROM  `physionet-data.mimic_derived.ventilator_setting` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.peep IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((peep))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
end tidal CO2 concentration,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, FROM  `physionet-data.mimic_icu.chartevents` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  itemid=228640 ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((stay_id))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Frequency of Heart rate records,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.heart_rateFROM  `physionet-data.mimic_derived.vitalsign` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.heart_rate IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((heart_rate))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Frequency of Systolic Blood pressure records,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.sbpFROM  `physionet-data.mimic_derived.vitalsign` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.sbp IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((sbp))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Cardiac Output,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.valueFROM  `physionet-data.mimic_icu.chartevents` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  itemid IN (228369, 229896, 229897, 220088, 224842)), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((value))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECTROUND(AVG(chemistry_concat_perd),2) AS avg_chemistry_perdFROMchemistry_perd_perpatient"
Frequency of Medication records,"WITH hospital_los_hr AS(
SELECT
hadm_id,
MIN(intime)AS begins,
MAX(outtime) AS finishes,
TIMESTAMP_DIFF(MIN(outtime), MAX(intime), HOUR) AS total_hours,
FROM
`physionet-data.mimic_icu.icustays`
GROUP BY
hadm_id 
-- Ensures LOS is positive
HAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), HOUR) > 0 
), group_creation AS (
SELECT
prescriptions.hadm_id,
CONCAT (starttime, drug) AS prescription_concat
FROM
`physionet-data.mimic_hosp.prescriptions` AS prescriptions
INNER JOIN
hospital_los_hr
USING
(hadm_id)
-- Ensures prescription takes places WITHIN the icu first and last ICU admission
WHERE 
prescriptions.starttime BETWEEN begins AND finishes
OR prescriptions.stoptime BETWEEN begins AND finishes
), prescription_perhr_perpatient AS (
SELECT
hadm_id,
COUNT(DISTINCT(prescription_concat))/total_hours AS prescription_perhr 
FROM
group_creation
JOIN hospital_los_hr
USING (hadm_id)
GROUP BY 
hadm_id, total_hours
)
SELECT
ROUND(AVG(prescription_perhr),2) AS avg_prescription_perhr
FROM
prescription_perhr_perpatient"
Detail of medication classification,
Method of medication registration,
Method of infusion registration,
Number records relating to fluid balance; if not easily discernable count all records containing ml?,"WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.urineoutputFROM  `physionet-data.mimic_derived.urine_output` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.urineoutput IS NOT NULL ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((urineoutput))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient
-----------------------
WITH hospital_los_hr AS(SELECT  stay_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), hour) AS total_hours,FROM`physionet-data.mimic_icu.icustays`GROUP BY  stay_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.stay_id, chemistry.amountFROM  `physionet-data.mimic_icu.inputevents` AS chemistryINNER JOIN  hospital_los_hrUSING  (stay_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.starttime BETWEEN begins AND finishes    AND  chemistry.amount >1     AND (chemistry.amountuom = 'ml' OR chemistry.amountuom= 'grams')   ), chemistry_perd_perpatient AS (SELECTstay_id,COUNT((amount))/total_hours  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (stay_id)GROUP BY stay_id, total_hours)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Number of Radiology reports,
Availability of radiology images,
Lactate,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.lactateFROM  `physionet-data.mimic_derived.bg` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.lactate IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((lactate))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
pO2,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.po2FROM  `physionet-data.mimic_derived.bg` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.po2 IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((po2))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Sodium,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.sodiumFROM  `physionet-data.mimic_derived.bg` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.sodium IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((sodium))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Hemoglobin,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.hemoglobinFROM  `physionet-data.mimic_derived.bg` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.hemoglobin IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((hemoglobin))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Leukocytes,"WITH hospital_los_hr AS(
SELECT
hadm_id,
MIN(intime)AS begins,
MAX(outtime) AS finishes,
TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,
FROM
`physionet-data.mimic_icu.icustays`
GROUP BY
hadm_id 
-- Ensures LOS is positive
HAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0 
), group_creation AS (
SELECT
chemistry.hadm_id, chemistry.wbc
FROM
`physionet-data.mimic_derived.complete_blood_count` AS chemistry
INNER JOIN
hospital_los_hr
USING
(hadm_id)
-- Ensures chemistry takes places WITHIN the icu first and last ICU admission
WHERE 
chemistry.charttime BETWEEN begins AND finishes
AND chemistry.wbc IS NOT NULL 
), chemistry_perd_perpatient AS (
SELECT
hadm_id,
COUNT((wbc))/total_days AS chemistry_concat_perd 
FROM
group_creation
JOIN hospital_los_hr
USING (hadm_id)
GROUP BY 
hadm_id, total_days
)
SELECT(
AVG(chemistry_concat_perd)) AS avg_chemistry_perd
, stddev(chemistry_concat_perd) AS stddev_chemistry_perd)
FROM
chemistry_perd_perpatient"
CRP,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.crpFROM  `physionet-data.mimic_derived.inflammation` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.crp IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((crp))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Procalcitonin,-
Creatinine,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.creatinineFROM  `physionet-data.mimic_derived.chemistry` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.creatinine IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((creatinine))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
ALAT,"WITH hospital_los_hr AS(SELECT  hadm_id,  MIN(intime)AS begins,  MAX(outtime) AS finishes,  TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) AS total_days,FROM`physionet-data.mimic_icu.icustays`GROUP BY  hadm_id -- Ensures LOS is positiveHAVING TIMESTAMP_DIFF(MIN(outtime), MAX(intime), DAY) > 0    ), group_creation AS (SELECTchemistry.hadm_id, chemistry.altFROM  `physionet-data.mimic_derived.enzyme` AS chemistryINNER JOIN  hospital_los_hrUSING  (hadm_id)   -- Ensures chemistry takes places WITHIN the icu first and last ICU admissionWHERE      chemistry.charttime BETWEEN begins AND finishes    AND  chemistry.alt IS NOT NULL ), chemistry_perd_perpatient AS (SELECThadm_id,COUNT((alt))/total_days  AS chemistry_concat_perd FROMgroup_creationJOIN hospital_los_hrUSING (hadm_id)GROUP BY hadm_id, total_days)SELECT(  AVG(chemistry_concat_perd)) AS avg_chemistry_perd, stddev(chemistry_concat_perd) AS stddev_chemistry_perdFROMchemistry_perd_perpatient"
Ethnicity,"SELECT distinct adm.subject_id, adm.ethnicity, icu.subject_id FROM physionet-data.mimic_core.admissions AS adminner JOIN physionet-data.mimic_icu.icustays AS icuON adm.subject_id = icu.subject_id"
Gender,"SELECT distinct adm.subject_id, adm.gender, icu.subject_id FROM `physionet-data.mimic_core.patients` AS adminner JOIN physionet-data.mimic_icu.icustays AS icuON adm.subject_id = icu.subject_id"
APACHE III,"SELECT distinct aps.apsiii, aps.subject_id, icu.subject_id FROM `physionet-data.mimic_derived.apsiii` as aps inner JOIN physionet-data.mimic_icu.icustays AS icu ON aps.subject_id = icu.subject_id   "
Median SOFA in first 24h,"SELECT distinct sofa.sofa_24hours, sofa.stay_id, icu.stay_id FROM `physionet-data.mimic_derived.sofa` as sofa inner JOIN physionet-data.mimic_icu.icustays AS icu ON sofa.stay_id = icu.stay_id where hr<24"
